# PostgreSQL production environment overrides

postgresql:
  image:
    tag: "16.3.0-debian-12-r14"
  
  auth:
    existingSecret: "postgresql-credentials"
  
  primary:
    persistence:
      size: 100Gi
      storageClass: "ebs-gp3"
    
    resources:
      requests:
        memory: 1Gi
        cpu: 500m
      limits:
        memory: 2Gi
        cpu: 2000m
    
    # Production-optimized configuration
    extendedConfiguration: |
      max_connections = 200
      shared_buffers = 512MB
      effective_cache_size = 2GB
      maintenance_work_mem = 256MB
      checkpoint_completion_target = 0.9
      wal_buffers = 16MB
      default_statistics_target = 100
      random_page_cost = 1.1
      effective_io_concurrency = 200
      work_mem = 4MB
      min_wal_size = 2GB
      max_wal_size = 8GB
      max_worker_processes = 4
      max_parallel_workers_per_gather = 2
      max_parallel_workers = 4
  
  # Enable backups for production
  backup:
    enabled: true
    cronjob:
      schedule: "0 2 * * *"  # Daily at 2 AM
      storage:
        size: 50Gi
  
  # Enable metrics for production monitoring
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
